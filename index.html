<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Happy New Year</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@300;500;700&family=Poppins:wght@600;800&display=swap" rel="stylesheet">
<style>
    html, body {
        margin: 0; width: 100%; height: 100%; overflow: hidden;
        background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
        font-family: 'Quicksand', sans-serif;
        touch-action: none; 
    }
    canvas { display: block; width: 100vw; height: 100vh; }

    #countText, #finalMessage {
        position: fixed; inset: 0; display: flex; flex-direction: column;
        align-items: center; justify-content: center; pointer-events: none;
        color: #fff; z-index: 10; padding: 20px;
    }

    #countText { 
        font-family: 'Poppins', sans-serif;
        font-size: clamp(80px, 25vw, 200px); 
        font-weight: 800; 
        background: linear-gradient(45deg, #fff, #ffd700, #ff6ec7, #00ffff);
        background-size: 200% 200%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: gradientShift 2s ease infinite, pulse 1s ease-in-out infinite;
        filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8));
        text-align: center;
    }

    @keyframes gradientShift {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    #finalMessage { 
        opacity: 0; 
        transition: opacity 2s ease; 
        text-align: center;
        animation: floatIn 3s ease-out forwards;
    }

    @keyframes floatIn {
        0% { transform: translateY(50px); opacity: 0; }
        100% { transform: translateY(0); opacity: 1; }
    }

    #finalMessage h2 {
        font-family: 'Dancing Script', cursive;
        font-size: clamp(20px, 6vw, 40px);
        background: linear-gradient(90deg, #ff6ec7, #ffd700, #00ffff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 8px;
        animation: shimmer 3s ease-in-out infinite;
        padding: 0 10px;
    }

    @keyframes shimmer {
        0%, 100% { filter: brightness(1) drop-shadow(0 0 10px rgba(255, 110, 199, 0.6)); }
        50% { filter: brightness(1.3) drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)); }
    }

    #finalMessage h1 {
        font-family: 'Poppins', sans-serif;
        font-size: clamp(28px, 10vw, 80px); 
        font-weight: 800;
        margin: 10px 0;
        padding: 0 10px;
        background: linear-gradient(to right, #ffd700, #ffed4e, #fff, #ffed4e, #ffd700);
        background-size: 200% auto;
        -webkit-background-clip: text; 
        -webkit-text-fill-color: transparent;
        filter: drop-shadow(0 0 25px rgba(255, 215, 0, 0.9)) drop-shadow(0 0 50px rgba(255, 255, 255, 0.5));
        animation: textGlow 2s ease-in-out infinite;
        word-wrap: break-word;
        max-width: 90%;
    }

    @keyframes textGlow {
        0%, 100% { 
            background-position: 0% center;
            filter: drop-shadow(0 0 25px rgba(255, 215, 0, 0.9)) drop-shadow(0 0 50px rgba(255, 255, 255, 0.5));
        }
        50% { 
            background-position: 100% center;
            filter: drop-shadow(0 0 40px rgba(255, 215, 0, 1)) drop-shadow(0 0 80px rgba(255, 255, 255, 0.8));
        }
    }

    #finalMessage p {
        font-size: clamp(14px, 4vw, 20px); 
        margin-top: 15px; 
        color: #f0f0f0;
        max-width: 90%; 
        line-height: 1.6;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        font-weight: 500;
        padding: 0 15px;
    }

    @media (max-width: 600px) {
        #countText { font-size: 20vw; }
        #finalMessage h1 { font-size: 12vw; line-height: 1.2; }
        #finalMessage h2 { font-size: 7vw; }
        #finalMessage p { font-size: 4vw; }
    }
</style>
</head>
<body>

<canvas id="canvas"></canvas>
<div id="countText">3</div>
<div id="finalMessage">
    <h1>HAPPY NEW YEAR 2026</h1>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
let w, h, dpr;

const fontSize = 14;
const neonColors = ["#ff3e3e", "#ffeb3b", "#3dffc5", "#38b6ff", "#ff77ff", "#ffffff"];
const textStr = "HAPPY NEW YEAR 2026";
let columns, drops = [];
let buildings = [];

function resize() {
    dpr = window.devicePixelRatio || 1;
    w = window.innerWidth;
    h = window.innerHeight;
    canvas.width = w * dpr;
    canvas.height = h * dpr;
    ctx.scale(dpr, dpr);
    columns = Math.floor(w / fontSize);
    initMatrix();
    generateCity();
}

function initMatrix() {
    drops = Array.from({ length: columns }, () => ({
        y: Math.random() * -100,
        speed: 1 + Math.random() * 2,
        index: Math.floor(Math.random() * textStr.length),
        color: neonColors[Math.floor(Math.random() * neonColors.length)]
    }));
}

function drawMatrix() {
    ctx.fillStyle = "rgba(2, 4, 10, 0.15)";
    ctx.fillRect(0, 0, w, h);
    ctx.font = `900 ${fontSize}px monospace`;
    drops.forEach((d, i) => {
        ctx.fillStyle = d.color;
        ctx.fillText(textStr[d.index % textStr.length], i * fontSize, d.y * fontSize);
        d.y += d.speed;
        if (d.y * fontSize > h) d.y = 0;
        d.index++;
    });
}

function generateCity() {
    buildings = [];
    let curX = 0;
    while (curX < w) {
        const bW = 40 + Math.random() * 60;
        const bH = 60 + Math.random() * (h * 0.3);
        const windows = [];
        for (let r = 10; r < bH - 10; r += 15) {
            for (let c = 5; c < bW - 10; c += 12) {
                if (Math.random() > 0.4) windows.push({ x: c, y: r, s: 0.001 + Math.random()*0.002, o: Math.random()*5 });
            }
        }
        buildings.push({ x: curX, w: bW, h: bH, windows });
        curX += bW + 4;
    }
}

function drawCity() {
    const ground = h * 0.92;
    buildings.forEach(b => {
        ctx.fillStyle = "#030408";
        ctx.fillRect(b.x, ground - b.h, b.w, b.h);
        b.windows.forEach(win => {
            const lum = Math.sin(Date.now() * win.s + win.o) > 0.2 ? 0.5 : 0.1;
            ctx.fillStyle = `rgba(255, 240, 150, ${lum})`;
            ctx.fillRect(b.x + win.x, ground - b.h + win.y, 5, 7);
        });
    });
}

const particles = [];
let fireworks = [];
let fallingPhotos = [];
let loadedPhotos = [];
const photoPaths = [
    'images/vy1.jpg', 
    'images/vy2.jpg', 
    'images/vy3.jpg', 
    'images/vy4.jpg',
    'images/vy5.jpg', 
    'images/vy6.jpg', 
    'images/vy7.jpg'
];

photoPaths.forEach(path => {
    const img = new Image();
    img.src = path;
    img.onload = () => loadedPhotos.push(img);
    img.onerror = () => console.error('Không tải được ảnh:', path);
});

class Firework {
    constructor(x, isHeart = false) {
        this.x = x || Math.random() * w;
        this.y = h * 0.92;
        this.targetY = h * 0.1 + Math.random() * (h * 0.4);
        this.vy = -(h * 0.01 + Math.random() * 5);
        this.isHeart = isHeart || Math.random() < 0.2;
        this.color = this.isHeart ? "#ff3377" : neonColors[Math.floor(Math.random() * neonColors.length)];
        this.exploded = false;
    }
    update() {
        if (!this.exploded) {
            this.y += this.vy;
            if (this.y <= this.targetY) { this.exploded = true; this.explode(); }
        }
    }
    explode() {
        const count = w < 600 ? 40 : 80;
        for (let i = 0; i < count; i++) {
            let vx, vy;
            if (this.isHeart) {
                const t = Math.random() * Math.PI * 2;
                vx = 16 * Math.pow(Math.sin(t), 3) * 0.12;
                vy = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t)) * 0.12;
            } else {
                const a = Math.random() * Math.PI * 2, s = Math.random() * 4 + 1;
                vx = Math.cos(a) * s; vy = Math.sin(a) * s;
            }
            particles.push({ x: this.x, y: this.y, vx, vy, color: this.color, life: 1 });
        }
    }
}

function updateItems() {
    if (Math.random() < 0.04) fireworks.push(new Firework());
    fireworks.forEach((f, i) => { 
        f.update(); 
        if (f.exploded) fireworks.splice(i, 1); 
        else { 
            ctx.fillStyle = "#fff"; 
            ctx.fillRect(f.x, f.y, 2, 6); 
        }
    });
    
    particles.forEach((p, i) => {
        p.vx *= 0.96; p.vy += 0.06; p.x += p.vx; p.y += p.vy; p.life -= 0.015;
        if (p.life <= 0) particles.splice(i, 1);
        else { 
            ctx.globalAlpha = p.life; 
            ctx.fillStyle = p.color; 
            ctx.beginPath(); 
            ctx.arc(p.x, p.y, 1.5, 0, Math.PI*2); 
            ctx.fill(); 
        }
    });
    
    // Tạo ảnh Polaroid rơi
    if (loadedPhotos.length > 0 && Math.random() < 0.01 && fallingPhotos.length < 4) {
        const photoSize = w < 600 ? 70 : 100;
        fallingPhotos.push({ 
            img: loadedPhotos[Math.floor(Math.random()*loadedPhotos.length)], 
            x: Math.random()*(w - photoSize - 40), 
            y: -150, 
            vy: 0.6 + Math.random() * 0.4, 
            rot: (Math.random() - 0.5) * 0.4, 
            rs: (Math.random() - 0.5) * 0.012, 
            op: 0,
            swing: Math.random() * Math.PI * 2,
            swingSpeed: 0.015 + Math.random() * 0.015,
            size: photoSize
        });
    }
    
    // Vẽ ảnh Polaroid
    fallingPhotos.forEach((p, i) => {
        p.y += p.vy; 
        p.rot += p.rs; 
        p.swing += p.swingSpeed;
        const swingOffset = Math.sin(p.swing) * 12;
        if (p.op < 1) p.op += 0.02;
        
        const halfSize = p.size / 2;
        const borderThick = p.size * 0.1;
        const bottomBorder = p.size * 0.25;
        
        ctx.save(); 
        ctx.translate(p.x + halfSize + swingOffset, p.y + halfSize + bottomBorder); 
        ctx.rotate(p.rot); 
        ctx.globalAlpha = p.op;
        
        // Bóng đổ Polaroid
        ctx.shadowColor = "rgba(0, 0, 0, 0.5)";
        ctx.shadowBlur = 20;
        ctx.shadowOffsetX = 4;
        ctx.shadowOffsetY = 10;
        
        // Viền trắng Polaroid
        ctx.fillStyle = "#fefefe";
        ctx.fillRect(-halfSize, -halfSize - bottomBorder, p.size, p.size + bottomBorder);
        
        // Reset shadow cho ảnh
        ctx.shadowColor = "transparent";
        
        // Vẽ ảnh bên trong
        const imgSize = p.size - borderThick * 2;
        ctx.drawImage(p.img, -halfSize + borderThick, -halfSize - bottomBorder + borderThick, imgSize, imgSize);
        
        // Hiệu ứng ánh sáng nhẹ trên ảnh
        const gradient = ctx.createLinearGradient(
            -halfSize + borderThick, 
            -halfSize - bottomBorder + borderThick, 
            halfSize - borderThick, 
            halfSize - borderThick
        );
        gradient.addColorStop(0, "rgba(255, 255, 255, 0.2)");
        gradient.addColorStop(0.5, "rgba(255, 255, 255, 0)");
        gradient.addColorStop(1, "rgba(0, 0, 0, 0.05)");
        ctx.fillStyle = gradient;
        ctx.fillRect(-halfSize + borderThick, -halfSize - bottomBorder + borderThick, imgSize, imgSize);
        
        // Viền mờ nhẹ cho Polaroid
        ctx.strokeStyle = "rgba(0, 0, 0, 0.1)";
        ctx.lineWidth = 1;
        ctx.strokeRect(-halfSize, -halfSize - bottomBorder, p.size, p.size + bottomBorder);
        
        ctx.restore();
        
        if (p.y > h + 100) fallingPhotos.splice(i, 1);
    });
    
    ctx.globalAlpha = 1;
}

let matrixVisible = true, showCity = false, fireworksActive = false;
const startEvt = 'ontouchstart' in window ? 'touchstart' : 'mousedown';
window.addEventListener(startEvt, (e) => {
    const x = e.touches ? e.touches[0].clientX : e.clientX;
    if (fireworksActive) fireworks.push(new Firework(x, true));
});

let count = 3;
const timer = setInterval(() => {
    count--;
    if (count > 0) document.getElementById("countText").textContent = count;
    else {
        clearInterval(timer); 
        document.getElementById("countText").style.display = "none";
        matrixVisible = false; 
        showCity = true; 
        fireworksActive = true;
        document.getElementById("finalMessage").style.opacity = "1";
    }
}, 1000);

function animate() {
    ctx.fillStyle = "rgba(2, 4, 10, 0.25)"; 
    ctx.fillRect(0, 0, w, h);
    if (matrixVisible) drawMatrix();
    if (showCity) { drawCity(); updateItems(); }
    requestAnimationFrame(animate);
}

window.addEventListener("resize", resize);
resize(); 
animate();
</script>
</body>
</html>
